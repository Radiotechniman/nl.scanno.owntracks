<!doctype html>
<html>
    <head>

    </head>
    <body>

        <h1 data-i18n="settings.app.title"></h1>
        <form id="owntrack-settings">

        <fieldset id="server">
            <legend>
                <label data-i18n="settings.app.server.server_title"></label>
            </legend>
            <div class="field">
                <input class="checkbox" id="otbroker" type="checkbox" checked="true"
                    onchange="owntracks-settings.server.server_settings.disabled = checked">
                <label class="form_label" for="otbroker" data-i18n="settings.app.server.public_broker"</label>
            </div>

            <fieldset id="server_settings">
                <legend>
                    <label data-i18n="settings.app.server.server_details"></label>
                </legend>

                <p data-i18n="settings.app.server.server_explanation"></p>

                <div class="field row">
                    <label class="form_label" for="Url" data-i18n="settings.app.server.url"></label>
                    <br>
                    <input class="form_input" id="url" type="text" value="" /> <br>
                </div>

                <div class="field row">
                    <label class="form_label" for="ip_port" data-i18n="settings.app.server.port"></label>
                    <br>
                    <input class="form_input" id="ip_port" type="text" value="1883" /> <br>
                </div>

                <div class="field">
                    <input class="checkbox" id="tls" type="checkbox"/>
                    <label class="form_label" for="TLS" data-i18n="settings.app.server.tls"></label>
                </div>

                <div class="field row">
                    <label class="form_label" for="User" data-i18n="settings.app.server.username"></label>
                    <br>
                    <input class="form_input" id="user" type="text" value="" /> <br>
                 </div>

                 <div class="field row">
                     <label class="form_label" for="Password" data-i18n="settings.app.server.password"></label>
                     <br>
                     <input class="form_input" id="password" type="password" value="" /> <br>
                </div>
            </fieldset>
        </fieldset>

        <fieldset id="client_settings">
            <legend>
                <label data-i18n="settings.app.client.client_settings"></label>
            </legend>
            
            <p data-i18n="settings.app.client.accuracy_explanation"></p>
            
            <div class="field row">
                <label class="form_label" for="Accuracy" data-i18n="settings.app.client.accuracy"></label>
                <br>
                <input class="form_input" id="accuracy" type="text" value="100" /> <br>
            </div>
            
            <p data-i18n="settings.app.client.topic_explanation"></p>
           
            <div class="field row">
                <label class="form_label" for="topic" data-i18n="settings.app.client.topic"></label>
                <br>
                <input class="form_input" id="topic" type="text" value="owntracks/+/+/event" /> <br>
            </div>
            
        </fieldset>
        </form>


        <button class="right" id="button_save" onclick="save()" data-i18n="settings.app.button.save">Save</button>


        <script type="text/javascript">

        function onHomeyReady(){

           Homey.get('otbroker', function(err, otbroker) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('otbroker').value = otbroker
                  }
                  if (typeof otbroker == 'undefined' || otbroker == null) otbroker = false;
                  document.getElementById('otbroker').checked = otbroker;
           })
           Homey.get('url', function(err, url) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('url').value = url
                  }
           })
           Homey.get('ip_port', function(err, ip_port) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('ip_port').value = ip_port
                  }
           })

           Homey.get('tls', function(err, tls) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('tls').value = tls
                  }
                  if (typeof tls == 'undefined' || tls == null) tls = false;
                  document.getElementById('tls').checked = tls;
           })
           Homey.get('user', function(err, user) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('user').value = user
                  }
           })
           Homey.get('password', function(err, password) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('password').value = password
                  }
           })
           Homey.get('accuracy', function(err, accuracy) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('accuracy').value = accuracy
                  }
           })
           Homey.get('topic', function(err, topic) {
                  if (err) {
                    console.error(err)
                  } else {
                    document.getElementById('topic').value = topic
                  }
           })
           console.log("Homey.ready");
           Homey.ready()
        }

        function save() {
            
            if (currentValues.otbroker != document.getElementById('otbroker').checked) {
                Homey.set('otbroker', document.getElementById('otbroker').checked)
            }
            
            if (currentValues.url != document.getElementById('url').value {
                Homey.set('url', document.getElementById('url').value)
            }

            if (currentValues.ip_port != document.getElementById('ip_port').value {
                Homey.set('ip_port', document.getElementById('ip_port').value)
            }
            
            if (currentValues.tls != document.getElementById('tls').checked {
                Homey.set('tls', document.getElementById('tls').checked)
            }

            if (currentValues.user != document.getElementById('user').value {
                Homey.set('user', document.getElementById('user').value)
            }

            if (currentValues.password != document.getElementById('password').value {
                Homey.set('password', document.getElementById('password').value)
            }

            if (currentValues.accuracy != document.getElementById('accuracy').value {
                Homey.set('accuracy', document.getElementById('accuracy').value)
            }
 
            if (currentValues.topic != document.getElementById('topic').value {
                Homey.set('topic', document.getElementById('topic').value)
            }
        }
        
        </script>

    </body>
</html>

